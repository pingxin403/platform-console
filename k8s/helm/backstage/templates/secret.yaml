apiVersion: v1
kind: Secret
metadata:
  name: backstage-secrets
  namespace: {{ include "backstage.namespace" . }}
  labels:
    {{- include "backstage.labels" . | nindent 4 }}
    app.kubernetes.io/component: secrets
  annotations:
    # Rotate secrets regularly for security
    secret.kubernetes.io/rotation-policy: "90d"
type: Opaque
data:
  backend-secret: {{ .Values.backstage.secrets.backendSecret | b64enc | quote }}
  github-client-id: {{ .Values.backstage.secrets.githubClientId | b64enc | quote }}
  github-client-secret: {{ .Values.backstage.secrets.githubClientSecret | b64enc | quote }}
  github-token: {{ .Values.backstage.secrets.githubToken | b64enc | quote }}
  {{- if .Values.backstage.secrets.argoCdToken }}
  argocd-token: {{ .Values.backstage.secrets.argoCdToken | b64enc | quote }}
  {{- end }}
  {{- if .Values.backstage.secrets.datadogApiKey }}
  datadog-api-key: {{ .Values.backstage.secrets.datadogApiKey | b64enc | quote }}
  {{- end }}
  {{- if .Values.backstage.secrets.datadogAppKey }}
  datadog-app-key: {{ .Values.backstage.secrets.datadogAppKey | b64enc | quote }}
  {{- end }}
---
{{- if not .Values.postgresql.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: backstage-postgres
  namespace: {{ include "backstage.namespace" . }}
  labels:
    {{- include "backstage.labels" . | nindent 4 }}
    app.kubernetes.io/component: database
type: Opaque
data:
  password: {{ .Values.externalPostgresql.password | b64enc | quote }}
{{- end }}
---
# TLS Secret for ingress (if using cert-manager)
{{- if .Values.ingress.tls.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "backstage.fullname" . }}-tls
  namespace: {{ include "backstage.namespace" . }}
  labels:
    {{- include "backstage.labels" . | nindent 4 }}
    app.kubernetes.io/component: tls
  annotations:
    cert-manager.io/cluster-issuer: {{ .Values.ingress.tls.clusterIssuer | default "letsencrypt-prod" }}
type: kubernetes.io/tls
data:
  tls.crt: ""
  tls.key: ""
{{- end }}